#textdomain wesnoth-Ageless_Era

# wmllint: unbalanced-on
#define AE_ABILITY_SHIFTER
    [dummy]
        id=AE_efm_ability_shifter
        name= _ "shifter"
        name_inactive= _ "shifter"
        description= _ "This unit changes form based on what terrain he is standing on.
Villages/Castles: Human
Open/Desert: Warthog
Water: Giant Beaver
Mountains/Hills: Bighorned Sheep
SnowCovered: Wolf
Forest/Cave: Bear"

        apply_to=self
    [/dummy] # wmlxgettext: [abilities]
[/abilities]

[event]
    name=side turn
    first_time_only=no
    id=AE_efm_shifter_event

    [store_locations]
        [filter]
            ability=AE_efm_ability_shifter
        [/filter]
        variable=AE_efm_var_hex_moved_on
    [/store_locations]

    [while]
        [variable]
            name=AE_efm_var_j
            less_than=$AE_efm_var_hex_moved_on.length
        [/variable]
        [do]
            [store_unit]
                [filter]
                    x=$AE_efm_var_hex_moved_on[$AE_efm_var_j].x
                    y=$AE_efm_var_hex_moved_on[$AE_efm_var_j].y
                [/filter]
                variable=AE_efm_var_unit_to_modify
                mode=append
            [/store_unit]
            [set_variable]
                name=AE_efm_var_j
                add=1
            [/set_variable]
        [/do]
    [/while]
    {CLEAR_VARIABLE AE_efm_var_j}

    [while]
        [variable]
            name=AE_efm_var_i
            less_than=$AE_efm_var_hex_moved_on.length
        [/variable]
        [do]
            # set the variable AE_efm_var_terrain_moved_on to forest,earth,water,air,desert or snow depending on the terrain the unit moved on.
            [if]
                [variable]
                    name=AE_efm_var_hex_moved_on[$AE_efm_var_i].terrain
                    contains=F
                [/variable]
                [or]
                    [variable]
                        name=AE_efm_var_hex_moved_on[$AE_efm_var_i].terrain
                        contains=Uf
                    [/variable]
                [/or]
                [or]
                    [variable]
                        name=AE_efm_var_hex_moved_on[$AE_efm_var_i].terrain
                        contains=Uu
                    [/variable]
                [/or]
                [or]
                    [variable]
                        name=AE_efm_var_hex_moved_on[$AE_efm_var_i].terrain
                        contains=Uh
                    [/variable]
                [/or]
                [not]
                    [variable]
                        name=AE_efm_var_hex_moved_on[$AE_efm_var_i].terrain
                        contains=Aa^
                    [/variable]
                [/not]
                [then]
                    [set_variable]
                        name=AE_efm_var_terrain_moved_on
                        value=bear
                    [/set_variable]
                [/then]
                [else]
                    [if]
                        [variable]
                            name=AE_efm_var_hex_moved_on[$AE_efm_var_i].terrain
                            contains=K
                        [/variable]
                        [or]
                            [variable]
                                name=AE_efm_var_hex_moved_on[$AE_efm_var_i].terrain
                                contains=C
                            [/variable]
                        [/or]
                        [or]
                            [variable]
                                name=AE_efm_var_hex_moved_on[$AE_efm_var_i].terrain
                                contains=Vh
                            [/variable]
                        [/or]
                        [or]
                            [variable]
                                name=AE_efm_var_hex_moved_on[$AE_efm_var_i].terrain
                                contains=Ve
                            [/variable]
                        [/or]
                        [then]
                            [set_variable]
                                name=AE_efm_var_terrain_moved_on
                                value=human
                            [/set_variable]
                        [/then]
                        [else]
                            [if]
                                [variable]
                                    name=AE_efm_var_hex_moved_on[$AE_efm_var_i].terrain
                                    contains=W
                                [/variable]
                                [or]
                                    [variable]
                                        name=AE_efm_var_hex_moved_on[$AE_efm_var_i].terrain
                                        contains=w
                                    [/variable]
                                [/or]
                                [then]
                                    [set_variable]
                                        name=AE_efm_var_terrain_moved_on
                                        value=beaver
                                    [/set_variable]
                                [/then]
                                [else]
                                    [if]
                                        [variable]
                                            name=AE_efm_var_hex_moved_on[$AE_efm_var_i].terrain
                                            equals=Ss^Vm
                                        [/variable]
                                        [or]
                                            [variable]
                                                name=AE_efm_var_hex_moved_on[$AE_efm_var_i].terrain
                                                equals=Ss
                                            [/variable]
                                        [/or]
                                        [then]
                                            [set_variable]
                                                name=AE_efm_var_terrain_moved_on
                                                value=beaver
                                            [/set_variable]
                                        [/then]
                                        [else]
                                            [if]
                                                [variable]
                                                    name=AE_efm_var_hex_moved_on[$AE_efm_var_i].terrain
                                                    equals=Hd
                                                [/variable]
                                                [or]
                                                    [variable]
                                                        name=AE_efm_var_hex_moved_on[$AE_efm_var_i].terrain
                                                        contains=D
                                                    [/variable]
                                                    [and]
                                                        [not]
                                                            [variable]
                                                                name=AE_efm_var_hex_moved_on[$AE_efm_var_i].terrain
                                                                equals=Dd^Dr
                                                            [/variable]
                                                        [/not]
                                                    [/and]
                                                [/or]
                                                [or]
                                                    [variable]
                                                        name=AE_efm_var_hex_moved_on[$AE_efm_var_i].terrain
                                                        contains=Gg
                                                    [/variable]
                                                    [and]
                                                        [not]
                                                            [variable]
                                                                name=AE_efm_var_hex_moved_on[$AE_efm_var_i].terrain
                                                                equals=Gg^Fet
                                                            [/variable]
                                                        [/not]
                                                    [/and]
                                                [/or]
                                                [or]
                                                    [variable]
                                                        name=AE_efm_var_hex_moved_on[$AE_efm_var_i].terrain
                                                        contains=Re
                                                    [/variable]
                                                [/or]
                                                [or]
                                                    [variable]
                                                        name=AE_efm_var_hex_moved_on[$AE_efm_var_i].terrain
                                                        contains=Rp
                                                    [/variable]
                                                [/or]
                                                [or]
                                                    [variable]
                                                        name=AE_efm_var_hex_moved_on[$AE_efm_var_i].terrain
                                                        contains=Gs
                                                    [/variable]
                                                [/or]
                                                [or]
                                                    [variable]
                                                        name=AE_efm_var_hex_moved_on[$AE_efm_var_i].terrain
                                                        contains=Re
                                                    [/variable]
                                                [/or]
                                                [or]
                                                    [variable]
                                                        name=AE_efm_var_hex_moved_on[$AE_efm_var_i].terrain
                                                        contains=Rd
                                                    [/variable]
                                                [/or]
                                                [or]
                                                    [variable]
                                                        name=AE_efm_var_hex_moved_on[$AE_efm_var_i].terrain
                                                        contains=Rr
                                                    [/variable]
                                                [/or]
                                                [or]
                                                    [variable]
                                                        name=AE_efm_var_hex_moved_on[$AE_efm_var_i].terrain
                                                        contains=Dd
                                                    [/variable]
                                                [/or]
                                                [then]
                                                    [set_variable]
                                                        name=AE_efm_var_terrain_moved_on
                                                        value=boar
                                                    [/set_variable]
                                                [/then]
                                                [else]
                                                    [if]
                                                        [variable]
                                                            name=AE_efm_var_hex_moved_on[$AE_efm_var_i].terrain
                                                            contains=A
                                                        [/variable]
                                                        [or]
                                                            [variable]
                                                                name=AE_efm_var_hex_moved_on[$AE_efm_var_i].terrain
                                                                equals=Ha
                                                            [/variable]
                                                        [/or]
                                                        [then]
                                                            [set_variable]
                                                                name=AE_efm_var_terrain_moved_on
                                                                value=wolf
                                                            [/set_variable]
                                                        [/then]
                                                        [else]
                                                            [if]
                                                                [variable]
                                                                    name=AE_efm_var_hex_moved_on[$AE_efm_var_i].terrain
                                                                    equals=Dd^Dr
                                                                [/variable]
                                                                [or]
                                                                    [variable]
                                                                        name=AE_efm_var_hex_moved_on[$AE_efm_var_i].terrain
                                                                        contains=H
                                                                    [/variable]
                                                                    [or]
                                                                        [variable]
                                                                            name=AE_efm_var_hex_moved_on[$AE_efm_var_i].terrain
                                                                            contains=M
                                                                        [/variable]
                                                                    [/or]
                                                                [/or]
                                                                [then]
                                                                    [set_variable]
                                                                        name=AE_efm_var_terrain_moved_on
                                                                        value=goat
                                                                    [/set_variable]
                                                                [/then]
                                                                [else]
                                                                    [set_variable]
                                                                        name=AE_efm_var_terrain_moved_on
                                                                        value=human
                                                                    [/set_variable]
                                                                [/else]
                                                            [/if]
                                                        [/else]
                                                    [/if]
                                                [/else]
                                            [/if]
                                        [/else]
                                    [/if]
                                [/else]
                            [/if]
                        [/else]
                    [/if]
                [/else]
            [/if]

            # mutates the unit according to the terrain
            [switch]
                variable=AE_efm_var_terrain_moved_on
                [case]
                    value=bear
                    [object]
                        silent=yes
                        [filter]
                            x=$AE_efm_var_hex_moved_on[$AE_efm_var_i].x
                            y=$AE_efm_var_hex_moved_on[$AE_efm_var_i].y
                        [/filter]
                        [effect]
                            apply_to=variation
                            name=shifter_bear
                        [/effect]
                    [/object]
                [/case]
                [case]
                    value=goat
                    [object]
                        silent=yes
                        [filter]
                            x=$AE_efm_var_hex_moved_on[$AE_efm_var_i].x
                            y=$AE_efm_var_hex_moved_on[$AE_efm_var_i].y
                        [/filter]
                        [effect]
                            apply_to=variation
                            name=shifter_goat
                        [/effect]
                    [/object]
                [/case]
                [case]
                    value=beaver
                    [object]
                        silent=yes
                        [filter]
                            x=$AE_efm_var_hex_moved_on[$AE_efm_var_i].x
                            y=$AE_efm_var_hex_moved_on[$AE_efm_var_i].y
                        [/filter]
                        [effect]
                            apply_to=variation
                            name=shifter_beaver
                        [/effect]
                    [/object]
                [/case]
                [case]
                    value=beaver
                    [object]
                        silent=yes
                        [filter]
                            x=$AE_efm_var_hex_moved_on[$AE_efm_var_i].x
                            y=$AE_efm_var_hex_moved_on[$AE_efm_var_i].y
                        [/filter]
                        [effect]
                            apply_to=variation
                            name=shifter_beaver
                        [/effect]
                    [/object]
                [/case]
                [case]
                    value=boar
                    [object]
                        silent=yes
                        [filter]
                            x=$AE_efm_var_hex_moved_on[$AE_efm_var_i].x
                            y=$AE_efm_var_hex_moved_on[$AE_efm_var_i].y
                        [/filter]
                        [effect]
                            apply_to=variation
                            name=shifter_warthog
                        [/effect]
                    [/object]
                [/case]
                [case]
                    value=wolf
                    [object]
                        silent=yes
                        [filter]
                            x=$AE_efm_var_hex_moved_on[$AE_efm_var_i].x
                            y=$AE_efm_var_hex_moved_on[$AE_efm_var_i].y
                        [/filter]
                        [effect]
                            apply_to=variation
                            name=shifter_wolf
                        [/effect]
                    [/object]
                [/case]
                [else]
                    [object]
                        silent=yes
                        [filter]
                            x=$AE_efm_var_hex_moved_on[$AE_efm_var_i].x
                            y=$AE_efm_var_hex_moved_on[$AE_efm_var_i].y
                        [/filter]
                        [effect]
                            apply_to=variation
                            name=shifter_human
                        [/effect]
                    [/object]
                [/else]
            [/switch]

            [store_unit]
                [filter]
                    x=$AE_efm_var_hex_moved_on[$AE_efm_var_i].x
                    y=$AE_efm_var_hex_moved_on[$AE_efm_var_i].y
                [/filter]
                variable=AE_efm_var_unit_modified
            [/store_unit]
            [set_variable]
                name=AE_efm_var_unit_modified.hitpoints
                value=$AE_efm_var_unit_to_modify[$AE_efm_var_i].hitpoints
            [/set_variable]
            [set_variables]
                name=AE_efm_var_unit_modified.status
                to_variable=AE_efm_var_unit_to_modify[$AE_efm_var_i].status
            [/set_variables]
            [set_variables]
                name=AE_efm_var_unit_modified.variables
                to_variable=AE_efm_var_unit_to_modify[$AE_efm_var_i].variables
            [/set_variables]
            [unstore_unit]
                variable=AE_efm_var_unit_modified
            [/unstore_unit]

            [set_variable]
                name=AE_efm_var_i
                add=1
            [/set_variable]

            {CLEAR_VARIABLE AE_efm_var_unit_modified}
        [/do]
    [/while]
    {CLEAR_VARIABLE AE_efm_var_i}

    {CLEAR_VARIABLE AE_efm_var_hex_moved_on}
    {CLEAR_VARIABLE AE_efm_var_unit_to_modify}
[/event]

[+abilities] # wmlxgettext: [/abilities]
#enddef
# wmllint: unbalanced-off
