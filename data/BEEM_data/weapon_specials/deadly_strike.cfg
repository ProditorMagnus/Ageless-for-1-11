#textdomain wesnoth-Ageless_Era

# wmllint: unbalanced-on
#define AE_WEAPON_SPECIAL_DEADLY_STRIKE
    [dummy]
        id=AE_deadly_strike
        name= _ "deadly strike"
        description= _ "This attack has a 6% chance per level difference to kill immediately a lower level enemy."
    [/dummy]# wmlxgettext: [specials]
[/specials] # wmlxgettext: [attack]
[/attack]
[event]
    name=attacker_hits
    first_time_only=no
    id=AE_deadly_strike1
    [filter_attack]
        special=AE_deadly_strike
    [/filter_attack]
    [if]
        [have_unit]
            x,y=$x2,$y2
            [not]
                side=side_number
            [/not]
        [/have_unit]
        [then]
            [if]
                [variable]
                    name=unit.level
                    greater_than=$second_unit.level
                [/variable]
                [then]
                    [set_variable]
                        name=leveldiff
                        value=$unit.level
                    [/set_variable]
                    [set_variable]
                        name=leveldiff
                        add=-$second_unit.level
                    [/set_variable]
                    [set_variable]
                        name=random
                        rand=1..100
                    [/set_variable]
                    [set_variable]
                        name=limit
                        value=6
                    [/set_variable]
                    [set_variable]
                        name=limit
                        multiply=$leveldiff
                    [/set_variable]
                    [if]
                        [variable]
                            name=random
                            less_than_equal_to=$limit
                        [/variable]
                        [then]
                            [set_variable]
                                name=exp
                                value=8
                            [/set_variable]
                            [set_variable]
                                name=exp
                                multiply=$second_unit.level
                            [/set_variable]
                            [set_variable]
                                name=exp
                                add=-$second_unit.level
                            [/set_variable]
                            [if]
                                [variable]
                                    name=exp
                                    numerical_equals=0
                                [/variable]
                                [then]
                                    [set_variable]
                                        name=exp
                                        value=4
                                    [/set_variable]
                                [/then]
                            [/if]
                            [unstore_unit]
                                variable=second_unit
                                red=255
                                text= _ "mortal hit"
                                find_vacant=no
                            [/unstore_unit]
                            [kill]
                                x,y=$x2,$y2
                                animate=yes
                                fire_event=yes
                            [/kill]
                            [set_variable]
                                name=unit.experience
                                add=$exp
                            [/set_variable]
                            [unstore_unit]
                                variable=unit
                            [/unstore_unit]
                        [/then]
                    [/if]
                    [clear_variable]
                        name=random
                    [/clear_variable]
                    [clear_variable]
                        name=leveldiff
                    [/clear_variable]
                    [clear_variable]
                        name=exp
                    [/clear_variable]
                    [clear_variable]
                        name=limit
                    [/clear_variable]
                [/then]
            [/if]
        [/then]
    [/if]
[/event]
[event]
    name=defender_hits
    first_time_only=no
    id=AE_deadly_strike2
    [filter_second_attack]
        special=AE_deadly_strike
    [/filter_second_attack]
    [if]
        [have_unit]
            x,y=$x1,$y1
            [not]
                side=side_number
            [/not]
        [/have_unit]
        [then]
            [if]
                [variable]
                    name=second_unit.level
                    greater_than=$unit.level
                [/variable]
                [then]
                    [set_variable]
                        name=leveldiff
                        value=$second_unit.level
                    [/set_variable]
                    [set_variable]
                        name=leveldiff
                        add=-$unit.level
                    [/set_variable]
                    [set_variable]
                        name=random
                        rand=1..100
                    [/set_variable]
                    [set_variable]
                        name=limit
                        value=6
                    [/set_variable]
                    [set_variable]
                        name=limit
                        multiply=$leveldiff
                    [/set_variable]
                    [if]
                        [variable]
                            name=random
                            less_than_equal_to=$limit
                        [/variable]
                        [then]
                            [set_variable]
                                name=exp
                                value=8
                            [/set_variable]
                            [set_variable]
                                name=exp
                                multiply=$unit.level
                            [/set_variable]
                            [set_variable]
                                name=exp
                                add=-$unit.level
                            [/set_variable]
                            [if]
                                [variable]
                                    name=exp
                                    numerical_equals=0
                                [/variable]
                                [then]
                                    [set_variable]
                                        name=exp
                                        value=4
                                    [/set_variable]
                                [/then]
                            [/if]
                            [unstore_unit]
                                variable=unit
                                red=255
                                text= _ "mortal hit"
                                find_vacant=no
                            [/unstore_unit]
                            [kill]
                                x,y=$x1,$y1
                                animate=yes
                                fire_event=yes
                            [/kill]
                            [set_variable]
                                name=second_unit.experience
                                add=$exp
                            [/set_variable]
                            [unstore_unit]
                                variable=second_unit
                            [/unstore_unit]
                        [/then]
                    [/if]
                    [clear_variable]
                        name=random
                    [/clear_variable]
                    [clear_variable]
                        name=leveldiff
                    [/clear_variable]
                    [clear_variable]
                        name=exp
                    [/clear_variable]
                    [clear_variable]
                        name=limit
                    [/clear_variable]
                [/then]
            [/if]
        [/then]
    [/if]
[/event]
[+attack]
    [+specials]
        # wmlxgettext: [/specials]
        # wmlxgettext: [/attack]
#enddef
# wmllint: unbalanced-off
