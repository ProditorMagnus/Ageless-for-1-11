#define WEAPON_SPECIAL_PIERCE
    [damage]
        id=pierce
        name= _ "pierce"
        description= _ "If this attack is used, the enemy behind the target is hurt as well, for 1/2 of the damage."
    [/damage]
[/specials]
[/attack]
[event]
    name=attacker hits
    first_time_only=no
    id=piercing_attack
    [filter_attack]
        special=pierce
    [/filter_attack]
    [if]
        [have_unit]
            x,y=$x1,$y1
            [filter_adjacent]
                x,y=$x2,$y2
                adjacent=n
            [/filter_adjacent]
        [/have_unit]
        [then]
            {VARIABLE pierce_direction n}
        [/then]
        [else]
            [if]
                [have_unit]
                    x,y=$x1,$y1
                    [filter_adjacent]
                        x,y=$x2,$y2
                        adjacent=ne
                    [/filter_adjacent]
                [/have_unit]
                [then]
                    {VARIABLE pierce_direction ne}
                [/then]
                [else]
                    [if]
                        [have_unit]
                            x,y=$x1,$y1
                            [filter_adjacent]
                                x,y=$x2,$y2
                                adjacent=se
                            [/filter_adjacent]
                        [/have_unit]
                        [then]
                            {VARIABLE pierce_direction se}
                        [/then]
                        [else]
                            [if]
                                [have_unit]
                                    x,y=$x1,$y1
                                    [filter_adjacent]
                                        x,y=$x2,$y2
                                        adjacent=s
                                    [/filter_adjacent]
                                [/have_unit]
                                [then]
                                    {VARIABLE pierce_direction s}
                                [/then]
                                [else]
                                    [if]
                                        [have_unit]
                                            x,y=$x1,$y1
                                            [filter_adjacent]
                                                x,y=$x2,$y2
                                                adjacent=sw
                                            [/filter_adjacent]
                                        [/have_unit]
                                        [then]
                                            {VARIABLE pierce_direction sw}
                                        [/then]
                                        [else]
                                            [if]
                                                [have_unit]
                                                    x,y=$x1,$y1
                                                    [filter_adjacent]
                                                        x,y=$x2,$y2
                                                        adjacent=nw
                                                    [/filter_adjacent]
                                                [/have_unit]
                                                [then]
                                                    {VARIABLE pierce_direction nw}
                                                [/then]
                                            [/if]
                                        [/else]
                                    [/if]
                                [/else]
                            [/if]
                        [/else]
                    [/if]
                [/else]
            [/if]
        [/else]
    [/if]
    [store_locations]
        [filter_adjacent_location]
            x,y=$x2,$y2
            adjacent=-$pierce_direction
        [/filter_adjacent_location]
        variable=pierce_target_hex
    [/store_locations]
    [harm_unit]
        [filter]
            x,y=$pierce_target_hex.x,$pierce_target_hex.y
        [/filter]
        amount="$($weapon.damage/2)"
        damage_type=pierce
        fire_event=yes
        experience=yes
        animate=no
    [/harm_unit]
    {CLEAR_VARIABLE pierce_direction,pierce_target_hex}
[/event]
[+attack]
    [+specials]
#enddef
