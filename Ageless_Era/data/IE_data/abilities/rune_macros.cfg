#textdomain wesnoth-Ageless_Era

#define AE_REMOVE_OBJECT FILTER NAME
#First, the unit is stored, it searches in modifications for objects with names
#like that, and deletes them. Then the unit is advanced to apply the changes,
#and then it gets the HP, movement, attack_left and exp of the original unit.
[store_unit]
	[filter]
		 {FILTER}
	[/filter]
	variable=gifted
	kill=no
[/store_unit]   #Stores the unit
{FOREACH gifted.modifications.object j}
	#{DEBUG_MSG $j}
	[if]
		[variable]
			name=gifted.modifications.object[$j].name
			equals={NAME}
		[/variable]
		[then]
			{CLEAR_VARIABLE gifted.modifications.object[$j]}
			{VARIABLE object_removed 1}
		[/then]
	[/if]
{NEXT j}
	[if]
		[variable]
			name=object_removed
			equals=1
		[/variable]
		[then]
			[unstore_unit]
					variable=gifted
				find_vacant=no
			[/unstore_unit]
			{ADVANCE_UNIT id=$gifted.id $gifted.type}
			[store_unit]
				[filter]
					x,y=$x1,$y1
				[/filter]
				variable=gifted2
				kill=no
			[/store_unit]
			{VARIABLE gifted2.max_hitpoints $gifted.max_hitpoints}
			{VARIABLE gifted2.hitpoints $gifted.hitpoints}
			{VARIABLE gifted2.experience $gifted.experience}
			{VARIABLE gifted2.level $gifted.level}
			{VARIABLE gifted2.moves $gifted.moves}
			{VARIABLE gifted2.attacks_left $gifted.attacks_left}
			[unstore_unit]
				   variable=gifted2
				find_vacant=no
			[/unstore_unit]
		[/then]
	[/if]
{CLEAR_VARIABLE object_removed}
{CLEAR_VARIABLE gifted}
{CLEAR_VARIABLE gifted2}
#enddef

#define INSERT_EFFECT CODE_NAME
	## this is the standard action that may be applied to a inscode previously created by DEF_CODE(S): it just inserts the code
	## it may be applied anywhere where insert_tag is possible

    # usage example:
    # {INS_CODE my_code}
	#{DEBUG_MSG CODE_NAME}
	[insert_tag]
		name=effect
		variable={CODE_NAME}
	[/insert_tag]
#enddef