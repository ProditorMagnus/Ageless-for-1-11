#textdomain wesnoth-Ageless_Era

#define WEAPON_SPECIAL_DEADLY_STRIKE TYPE WEAPON

    [dummy]
        id=deadly_strike
        name= _ "deadly strike"
        description=_"
this attack has a 6% chance to kill immediately a lower level enemy."
    [/dummy]
[/specials]
[/attack]
[event]
    name=attacker_hits
    first_time_only=no
    [filter]
        type={TYPE}
    [/filter]
    [filter_attack]
        name={WEAPON}
    [/filter_attack]
    #	[message]
    #		speaker=unit
    #		message= _ "I pass the filter"
    #	[/message]
    [if]
        [have_unit]
            x,y=$x2,$y2
            [not]
                side=side_number
            [/not]
        [/have_unit]
        [then]
            [if]
                [variable]
                    name=unit.level
                    greater_than=$second_unit.level
                [/variable]
                [then]
                    [set_variable]
                        name=leveldiff
                        value=$unit.level
                    [/set_variable]
                    [set_variable]
                        name=leveldiff
                        add=-$second_unit.level
                    [/set_variable]
                    #					[message]
                    #						speaker=unit
                    #						message= _ "I pass the first if"
                    #					[/message]
                    #					[message]
                    #						speaker=unit
                    #						message= $leveldiff
                    #					[/message]
                    [set_variable]
                        name=random
                        rand=1..100
                    [/set_variable]
                    [set_variable]
                        name=limit
                        value=6
                    [/set_variable]
                    [set_variable]
                        name=limit
                        multiply=$leveldiff
                    [/set_variable]
                    #					[message]
                    #						speaker=unit
                    #						message=$limit
                    #					[/message]
                    #					[message]
                    #						speaker=unit
                    #						message=$random
                    #					[/message]
                    [if]
                        [variable]
                            name=random
                            less_than_equal_to=$limit
                        [/variable]
                        [then]
                            [set_variable]
                                name=exp
                                value=8
                            [/set_variable]
                            [set_variable]
                                name=exp
                                multiply=$second_unit.level
                            [/set_variable]
                            [set_variable]
                                name=exp
                                add=-$second_unit.level
                            [/set_variable]
                            [if]
                                [variable]
                                    name=exp
                                    numerical_equals=0
                                [/variable]
                                [then]
                                    [set_variable]
                                        name=exp
                                        value=4
                                    [/set_variable]
                                [/then]
                            [/if]
                            #							[message]
                            #								speaker=unit
                            #								message=$exp
                            #							[/message]
                            [unstore_unit]
                                variable=second_unit
                                red=255
                                text= _ "mortal hit"
                                find_vacant=no
                            [/unstore_unit]
                            [kill]
                                x,y=$x2,$y2
                                animate=yes
                            [/kill]
                            [set_variable]
                                name=unit.experience
                                add=$exp
                            [/set_variable]
                            [unstore_unit]
                                variable=unit
                            [/unstore_unit]
                        [/then]
                    [/if]
                    [clear_variable]
                        name=random
                    [/clear_variable]
                    [clear_variable]
                        name=leveldiff
                    [/clear_variable]
                    [clear_variable]
                        name=exp
                    [/clear_variable]
                    [clear_variable]
                        name=limit
                    [/clear_variable]
                [/then]
                #				[else]
                #					[message]
                #						speaker=unit
                #						message= _ "my level is too low"
                #					[/message]
                #				[/else]
            [/if]
        [/then]
    [/if]
[/event]
[+attack]
    [+specials]
#enddef
