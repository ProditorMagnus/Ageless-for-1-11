#textdomain wesnoth-Ageless_Era

#define ABILITY_RUNEAURA
    [dummy]
        id=runeaura
        name= _ "Rune Aura"
        description=_"
When this ability is activated, all Rune Masters create special auras. Adjacent friendly units on hexes: s, ne, nw receive a 99% bonus to fire, cold and arcane resistance. Other units receive a -99% bonus to fire, cold and arcane resistance. The transformation lasts for one turn. Transformated unit cannot attack."
    [/dummy]
[/abilities]

[event]
    name=start
    [if]
        [have_unit]
            ability=runeaura
        [/have_unit]
        [then]
            {RUNEAURA_MENU}
        [/then]
    [/if]
[/event]

[event]
    name=recruit
    [filter]
        ability=runeaura
    [/filter]
    {RUNEAURA_MENU}
[/event]

[event]
    name=post_advance
    [filter]
        ability=runeaura
    [/filter]
    {RUNEAURA_MENU}
[/event]

[+abilities]
#enddef

#define RUNEAURA_MENU

    [set_menu_item]
        id=runeaura_menu
        description= _ "Activate Aura (24g)"
        [show_if]
        [/show_if]

        [filter_location]
            [filter]
                ability=runeaura
                side=$side_number
            [/filter]
        [/filter_location]
        [command]
            [store_gold]
                variable=actualgold
                side=$side_number
            [/store_gold]
            [if]
                [variable]
                    name=actualgold
                    greater_than=23
                [/variable]
                [then]
                    [message]
                        speaker=unit
                        image="portraits/ancient dwarves/transparent/runemaster.png"
                        message= _ "Activate aura? (cost: 24g)"
                        [option]
                            message= _ {MENU_IMG_TXT "ad-dwarves/runemaster.png" _"No"}
                            [command]
                            [/command]
                        [/option]

                        [option]
                            message= _ {MENU_IMG_TXT "ad-dwarves/runemaster2.png" _"Yes"}
                            [command]
                                [gold]
                                    amount=-24
                                    side=$side_number
                                [/gold]
                                {TRANSFORM_UNIT (type=AE RuneMaster) (AE RuneMaster2)}
                            [/command]
                        [/option]
                    [/message]
                [/then]
                [else]
                    [print]
                        text= _ "You don't have enough gold to activate the rune aura!"
                        size=18
                        red=255
                    [/print]
                [/else]
            [/if]
            [clear_variable]
                name=actualgold
            [/clear_variable]
        [/command]
    [/set_menu_item]
#enddef

#define ABILITY_RUNEAURAACTIVE
    [resistance]
        id=runeauraactive
        add=99
        max_value=99
        apply_to=fire,cold,arcane
        name= _ "Rune Aura"
        description=_"
Adjacent friendly units on hexes: s, ne, nw receive a 99% bonus to fire, cold and arcane resistance. Other units receive a -99% bonus to fire, cold and arcane resistance."
        affect_self=no
        affect_allies=yes
        affect_enemies=yes
        [affect_adjacent]
            adjacent=n,se,sw
        [/affect_adjacent]
    [/resistance]
    [resistance]
        id=runeauraactive
        value=-99
        max_value=-99
        apply_to=fire,cold,arcane
        affect_self=no
        affect_allies=yes
        affect_enemies=yes
        [affect_adjacent]
            adjacent=s,nw,ne
        [/affect_adjacent]
    [/resistance]
#enddef
